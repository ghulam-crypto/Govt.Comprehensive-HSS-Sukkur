<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Govt. Comprehensive HSS Sukkur</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Dancing+Script:wght@700&family=Libre+Barcode+39+Text&display=swap" rel="stylesheet">
    
    <style>
        :root { --school-green: #166534; --school-gold: #fbbf24; }
        body { font-family: 'Segoe UI', sans-serif; background: #f3f4f6; }
        
        /* Helpers */
        .slide { display: none; animation: fade 1.5s; }
        .slide.active { display: block; }
        @keyframes fade { from {opacity: .4} to {opacity: 1} }
        .hidden { display: none !important; }
        .watermark { position: absolute; top:50%; left:50%; transform:translate(-50%,-50%) rotate(-45deg); opacity:0.08; pointer-events:none; font-size:4rem; font-weight:900; color:#166534; white-space:nowrap; }

        /* Fonts */
        .font-id-body { font-family: 'Outfit', sans-serif; }
        .font-signature { font-family: 'Dancing Script', cursive; }
        .font-barcode { font-family: 'Libre Barcode 39 Text', cursive; font-size: 48px; }

        /* Auto-adjust Text Logic */
        .fit-text { display: inline-block; white-space: nowrap; }

        /* --- STRICT PRINTING RULES --- */
        @media print {
            /* Hide EVERYTHING by default */
            body * { visibility: hidden; }
            
            /* Only show the element with class 'print-now' and its children */
            .print-now, .print-now * { visibility: visible; }
            
            /* Position the print-now element at the very top-left */
            .print-now { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                margin: 0; 
                padding: 0;
                background: white; 
                z-index: 9999;
            }
            
            /* Hide buttons/controls inside the printable area */
            .no-print { display: none !important; }
            
            /* Ensure colors print correctly */
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="bg-green-900 text-white shadow-xl sticky top-0 z-50 no-print">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center space-x-4 cursor-pointer" onclick="showSection('home')">
                    <div class="bg-white p-2 rounded-full shadow-lg">
                        <img src="https://lh3.googleusercontent.com/d/1jnNNiAc2-DZUtVkABXetBkMGqB0olPju" class="w-10 h-10 rounded-full bg-white p-1" alt="Logo">
                    </div>
                    <div>
                        <h1 class="text-xl md:text-2xl font-bold uppercase tracking-wide">Govt. Comprehensive</h1>
                        <h2 class="text-sm md:text-base text-green-200 font-semibold">Higher Secondary School Sukkur</h2>
                        <div class="text-xs text-green-300 mt-1 flex gap-3">
                            <span><i class="inline w-3 h-3" data-lucide="map-pin"></i> Board Office Road, Makha Goth</span>
                            <span class="bg-green-800 px-2 rounded">SEMIS: 418050146</span>
                        </div>
                    </div>
                </div>
                <nav class="flex gap-2 text-xs md:text-sm font-bold mt-2 md:mt-0 overflow-x-auto">
                    <button onclick="showSection('home')" class="nav-btn hover:text-yellow-400">Home</button>
                    <button onclick="showSection('gallery')" class="nav-btn hover:text-yellow-400">Gallery</button>
                    <button onclick="showSection('academics')" class="nav-btn hover:text-yellow-400">Academics</button>
                    <button onclick="openLoginModal()" id="btn-login" class="bg-yellow-500 text-black px-3 py-1 rounded hover:bg-yellow-400">Login</button>
                    <button onclick="logout()" id="btn-logout" class="hidden bg-red-600 text-white px-3 py-1 rounded">Logout</button>
                </nav>
            </div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-6">

        <div id="section-home" class="page-section space-y-8">
            <div class="relative h-64 md:h-96 rounded-2xl overflow-hidden shadow-2xl border-b-4 border-green-600 group">
                <img src="https://lh3.googleusercontent.com/d/1CNhh5MMo1Ks07LEUQvddU5kasZGYjYif" class="slide active w-full h-full object-cover">
                <img src="https://lh3.googleusercontent.com/d/15wbNoMTWczFgAP9j5BobBryp6l9supvX" class="slide w-full h-full object-cover">
                <img src="https://lh3.googleusercontent.com/d/1diwpdDpgkiJQ7YZzDlk9WXUv2GOP0f84" class="slide w-full h-full object-cover">
                <img src="https://lh3.googleusercontent.com/d/1pzGInepUMFbZ3ePsGp0SkLQy0hPi2OAV" class="slide w-full h-full object-cover">
                <img src="https://lh3.googleusercontent.com/d/19G2MWRjeVaRoszZwAWh_YvQjkOLAAHCw" class="slide w-full h-full object-cover">
                <img src="https://lh3.googleusercontent.com/d/1hNQcgS7Jee97zWe9sLoPD-XO9jaFhNYN" class="slide w-full h-full object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent flex items-end p-8">
                    <h2 class="text-white text-3xl font-bold">Empowering Future Generations</h2>
                </div>
            </div>

            <div class="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                <h3 class="font-bold text-gray-700 mb-4 px-2 border-b flex items-center">
                    <i data-lucide="bar-chart-2" class="w-5 h-5 mr-2 text-green-700"></i> Daily Attendance
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <div class="bg-green-50 rounded-xl p-4 flex items-center shadow-sm border border-green-100">
                        <div class="w-1/3 relative h-24">
                            <canvas id="studentChart"></canvas>
                        </div>
                        <div class="w-2/3 pl-6 border-l border-green-200">
                            <h4 class="text-xs font-bold text-green-800 uppercase tracking-widest">Students</h4>
                            <div class="flex items-baseline gap-2 mt-1">
                                <span class="text-3xl font-extrabold text-green-900">85%</span>
                                <span class="text-xs text-green-600 font-medium">Present</span>
                            </div>
                            <p class="text-[10px] text-gray-500 mt-1">Total Strength: 1,240</p>
                        </div>
                    </div>

                    <div class="bg-blue-50 rounded-xl p-4 flex items-center shadow-sm border border-blue-100">
                        <div class="w-1/3 relative h-24">
                            <canvas id="teacherChart"></canvas>
                        </div>
                        <div class="w-2/3 pl-6 border-l border-blue-200">
                            <h4 class="text-xs font-bold text-blue-800 uppercase tracking-widest">Staff</h4>
                            <div class="flex items-baseline gap-2 mt-1">
                                <span class="text-3xl font-extrabold text-blue-900">96%</span>
                                <span class="text-xs text-blue-600 font-medium">Present</span>
                            </div>
                            <p class="text-[10px] text-gray-500 mt-1">Total Staff: 85</p>
                        </div>
                    </div>

                </div>
            </div>

            <div class="grid md:grid-cols-3 gap-6">
                <div class="md:col-span-2 grid md:grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow border-l-4 border-green-600 flex gap-4">
                        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="w-16 h-16 rounded-full">
                        <div><h3 class="font-bold">Senior Principal</h3><p class="text-sm text-gray-500">Abdul Ghafoor Arain</p></div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow border-l-4 border-yellow-500 flex gap-4">
                        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135768.png" class="w-16 h-16 rounded-full">
                        <div><h3 class="font-bold">Principal</h3><p class="text-sm text-gray-500">Abdul Wahab</p></div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="bg-red-600 text-white p-2 font-bold flex items-center"><i data-lucide="bell" class="w-4 h-4 mr-2"></i> Notice Board</div>
                    <div id="notice-board" class="p-4 h-32 overflow-y-auto text-sm">Loading...</div>
                </div>
            </div>

            <div class="bg-white p-2 rounded-xl shadow-md">
                <h3 class="font-bold text-gray-700 mb-2 px-2">School Location</h3>
                <iframe src="https://www.google.com/maps/embed?pb=!1m10!1m8!1m3!1d3532.1550966994587!2d68.8427197!3d27.7124972!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2s!4v1769263235593!5m2!1sen!2s" 
                        width="100%" height="250" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
        </div>

        <div id="section-gallery" class="page-section hidden">
            <div class="flex items-center gap-3 mb-4">
                <button onclick="showSection('home')" class="bg-gray-200 hover:bg-gray-300 text-gray-700 p-2 rounded-full transition" title="Go Back">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </button>
                <h2 class="text-2xl font-bold text-green-800">School Gallery</h2>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <img src="https://lh3.googleusercontent.com/d/1CNhh5MMo1Ks07LEUQvddU5kasZGYjYif" class="rounded shadow hover:scale-105 transition object-cover h-40 w-full">
                <img src="https://lh3.googleusercontent.com/d/15wbNoMTWczFgAP9j5BobBryp6l9supvX" class="rounded shadow hover:scale-105 transition object-cover h-40 w-full">
                <img src="https://lh3.googleusercontent.com/d/1diwpdDpgkiJQ7YZzDlk9WXUv2GOP0f84" class="rounded shadow hover:scale-105 transition object-cover h-40 w-full">
                <img src="https://lh3.googleusercontent.com/d/1pzGInepUMFbZ3ePsGp0SkLQy0hPi2OAV" class="rounded shadow hover:scale-105 transition object-cover h-40 w-full">
            </div>
        </div>

        <div id="section-academics" class="page-section hidden">
            <div class="flex items-center gap-3 mb-4">
                <button onclick="showSection('home')" class="bg-gray-200 hover:bg-gray-300 text-gray-700 p-2 rounded-full transition" title="Go Back">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </button>
                <h2 class="text-2xl font-bold text-green-800">Academics & Admission</h2>
            </div>
            
            <div class="bg-white p-6 rounded shadow mb-6 border-l-4 border-green-600">
                <h3 class="font-bold text-lg mb-2">Admission Policy</h3>
                <p class="text-gray-600 mb-4">Admissions are open for Class XI (Pre-Medical, Pre-Engineering, CS). Please visit the admin office with your Matriculation marksheet.</p>
                <button onclick="alert('Downloading Admission Form...')" class="bg-green-700 text-white px-4 py-2 rounded flex items-center hover:bg-green-800">
                    <i data-lucide="download" class="w-4 h-4 mr-2"></i> Download Admission Form
                </button>
            </div>
            <iframe src="https://calendar.google.com/calendar/embed?src=en.pk%23holiday%40group.v.calendar.google.com&ctz=Asia%2FKarachi" style="border: 0" width="100%" height="400" frameborder="0" scrolling="no"></iframe>
        </div>

        <div id="section-student" class="page-section hidden">
            <div class="flex justify-between items-center mb-4 no-print">
                <div class="flex items-center gap-3">
                    <button onclick="showSection('home')" class="bg-gray-200 hover:bg-gray-300 text-gray-700 p-2 rounded-full transition" title="Go Back">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                    </button>
                    <h2 class="text-xl font-bold">Student Result</h2>
                </div>
                <div class="gap-2 flex">
                    <button onclick="printArea('student-marksheet')" class="bg-blue-600 text-white px-3 py-1 rounded">Print Marksheet</button>
                    <button onclick="generateCard('student')" class="bg-purple-600 text-white px-3 py-1 rounded">Print ID Card</button>
                </div>
            </div>
            
            <div id="student-marksheet" class="bg-white rounded-none md:rounded-xl shadow-lg border border-gray-300 relative overflow-hidden p-8 min-h-[600px] max-w-4xl mx-auto mb-10">
                <div class="watermark">Govt. Comprehensive HS School</div>
                
                <div class="text-center border-b-2 border-green-800 pb-4 mb-6">
                    <div class="flex justify-center items-center gap-4 mb-2">
                        <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center border border-gray-200">
                            <img src="https://lh3.googleusercontent.com/d/1jnNNiAc2-DZUtVkABXetBkMGqB0olPju" class="w-10 h-10 rounded-full bg-white p-1" alt="Logo">
                        </div>
                        <div>
                            <h1 class="text-3xl font-extrabold text-green-900 uppercase">Govt. Comprehensive</h1>
                            <h2 class="text-lg font-bold text-gray-700">Higher Secondary School Sukkur</h2>
                            <p class="text-sm text-gray-500">SEMIS CODE: 418050146</p>
                        </div>
                    </div>
                    <span class="bg-black text-white px-4 py-1 rounded text-sm font-bold uppercase tracking-widest"> Official Marks certificate</span>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6 relative z-10" id="marksheet-meta"></div>

                <table class="w-full border-collapse border border-gray-300 text-sm relative z-10 mb-6">
                    <thead class="bg-green-100">
                        <tr>
                            <th class="border border-gray-300 p-2 text-left">Subject</th>
                            <th class="border border-gray-300 p-2 text-right">Max Marks</th>
                            <th class="border border-gray-300 p-2 text-right">Obtained</th>
                        </tr>
                    </thead>
                    <tbody id="marksheet-body"></tbody>
                    <tfoot class="bg-gray-50 font-bold">
                        <tr>
                            <td class="border border-gray-300 p-2">Grand Total</td>
                            <td class="border border-gray-300 p-2 text-right" id="marksheet-max-total">--</td>
                            <td class="border border-gray-300 p-2 text-right text-green-800 text-lg" id="marksheet-total">--</td>
                        </tr>
                    </tfoot>
                </table>

                <div class="text-center mb-8 relative z-10">
                    <span class="text-gray-600 font-medium">Result Status: </span>
                    <span id="rResult" class="text-2xl font-bold">--</span>
                </div>

                <div class="flex justify-between items-end mt-12 relative z-10 pt-8">
                    <div class="text-center">
                        <div class="border-b border-black w-40 mb-1"></div>
                        <p class="text-xs font-bold">Class Teacher</p>
                    </div>
                    <div class="text-center">
                        <div class="border-b border-black w-40 mb-1"></div>
                        <p class="text-xs font-bold">Senior Principal</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="section-teacher" class="page-section hidden">
            <div class="flex items-center gap-3 mb-4">
                <button onclick="showSection('home')" class="bg-gray-200 hover:bg-gray-300 text-gray-700 p-2 rounded-full transition" title="Go Back">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </button>
                <h2 class="text-2xl font-bold text-green-800">Teacher Dashboard</h2>
            </div>

            <div class="flex gap-4 mb-6 border-b">
                <button onclick="showTeacherTab('attendance')" class="pb-2 border-b-2 border-green-600 font-bold">Mark Attendance</button>
                <button onclick="showTeacherTab('result')" class="pb-2 text-gray-500">Update Results</button>
                <button onclick="generateCard('staff')" class="ml-auto bg-purple-600 text-white px-2 py-1 rounded text-xs mb-2">My ID Card</button>
            </div>

            <div id="tab-attendance">
                <div class="flex gap-2 mb-4">
                    <input type="text" id="att-class" placeholder="Class & Section (e.g., 11-A)" class="border p-2 rounded w-64">
                    <button onclick="loadAttendanceList()" class="bg-green-600 text-white px-4 rounded">Fetch Class</button>
                </div>
                <div id="attendance-grid" class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4"></div>
                <button id="btn-submit-att" onclick="submitAttendance()" class="hidden bg-red-600 text-white px-6 py-2 rounded font-bold">Submit Absentees</button>
            </div>
            
            <div id="tab-result" class="hidden">
                <div class="bg-white p-6 rounded shadow mb-4">
                    <h3 class="font-bold mb-4">Update Result (Class-wise)</h3>
                    <div class="flex gap-2 mb-4">
                         <input type="text" id="res-class" placeholder="Class & Section (e.g. 12-B)" class="border p-2 rounded w-64">
                         <button onclick="alert('Fetching class list for grading...')" class="bg-blue-600 text-white px-4 rounded">Load Class</button>
                    </div>
                    <p class="text-xs text-gray-500">Or search individual student:</p>
                    <div class="flex gap-2 mt-2">
                        <input type="text" placeholder="Seat Number" class="border p-2 rounded">
                        <button class="bg-gray-600 text-white px-4 rounded">Search</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="section-gr" class="page-section hidden">
            <div class="flex items-center gap-3 mb-4 border-b border-blue-200 pb-2">
                <button onclick="showSection('home')" class="bg-gray-200 hover:bg-gray-300 text-gray-700 p-2 rounded-full transition" title="Go Back">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </button>
                <h2 class="text-2xl font-bold text-blue-800">G.R. Incharge Portal</h2>
            </div>

            <div class="bg-white p-6 rounded shadow mb-6 no-print">
                <label class="block font-bold mb-2">Search Student Bio-Data</label>
                <div class="flex gap-2">
                    <input type="text" id="gr-search" placeholder="Enter GR Number or Name" class="w-full border p-2 rounded">
                    <button onclick="searchGRData()" class="bg-blue-600 text-white px-6 rounded font-bold">Search</button>
                </div>
            </div>

            <div id="gr-result-view" class="hidden">
                <div class="flex gap-2 mb-4 no-print">
                    <button onclick="printArea('gr-detail-card')" class="bg-gray-800 text-white px-4 py-2 rounded">Print Detail</button>
                    <button onclick="printArea('slc-card')" class="bg-red-800 text-white px-4 py-2 rounded">Print SLC</button>
                    <button onclick="generateCard('gr-student')" class="bg-purple-800 text-white px-4 py-2 rounded">Print ID Card</button>
                </div>

                <div id="gr-detail-card" class="bg-white p-10 border max-w-3xl mx-auto shadow mb-10">
                    <div class="watermark">STUDENT RECORD</div>
                    <header class="text-center mb-8 border-b-2 border-black pb-4">
                        <h1 class="text-2xl font-bold">GOVT. COMPREHENSIVE H.S.S SUKKUR</h1>
                        <p class="font-bold">STUDENT BIO-DATA REPORT</p>
                    </header>
                    <div id="gr-data-content" class="grid grid-cols-2 gap-6 text-sm"></div>
                    <div class="mt-12 flex justify-between">
                        <div class="text-center"><p>___________________</p><p class="font-bold">G.R Incharge</p></div>
                        <div class="text-center"><p>___________________</p><p class="font-bold">Senior Principal</p></div>
                    </div>
                </div>

                <div id="slc-card" class="bg-white p-10 border max-w-3xl mx-auto shadow hidden">
                    <div class="watermark">LEAVING CERT</div>
                    <header class="text-center mb-8">
                        <h1 class="text-3xl font-serif font-bold text-green-900">School Leaving Certificate</h1>
                        <p class="italic">Govt. Comprehensive Higher Secondary School Sukkur</p>
                    </header>
                    <div class="space-y-6 text-lg font-serif leading-relaxed px-8">
                        <p>This is to certify that <span class="font-bold border-b border-black px-2" id="slc-name"></span></p>
                        <p>Son of <span class="font-bold border-b border-black px-2" id="slc-father"></span></p>
                        <p>G.R No: <span class="font-bold border-b border-black px-2" id="slc-gr"></span> was a bona fide student of this institution.</p>
                        <p>His date of birth according to our record is <span class="font-bold border-b border-black px-2" id="slc-dob"></span>.</p>
                        <p>He leaves the school with <span class="font-bold">GOOD</span> moral character.</p>
                    </div>
                    <div class="mt-20 flex justify-between">
                        <div class="text-center"><p>___________________</p><p>Clerk</p></div>
                        <div class="text-center"><p>___________________</p><p>Principal</p></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="section-admin" class="page-section hidden">
            <div class="flex items-center gap-3 mb-4">
                <button onclick="showSection('home')" class="bg-gray-200 hover:bg-gray-300 text-gray-700 p-2 rounded-full transition" title="Go Back">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </button>
                <h2 class="text-2xl font-bold text-red-800">Admin Panel</h2>
            </div>

            <div class="bg-white p-6 rounded shadow mt-4 border-l-4 border-blue-600">
                <h3 class="font-bold mb-4 text-lg">Post News / Event / Gallery</h3>
                <div class="grid grid-cols-1 gap-4 mb-4">
                    <input type="text" placeholder="Title of News or Event" class="border p-2 rounded w-full">
                    <textarea placeholder="Description or Details" class="border p-2 rounded w-full h-20"></textarea>
                    
                    <div class="flex gap-4">
                        <div class="flex-1">
                            <label class="block text-xs font-bold text-gray-500 mb-1">Upload Image/Video</label>
                            <input type="file" class="border p-2 rounded w-full bg-gray-50">
                        </div>
                        <div class="flex-1">
                            <label class="block text-xs font-bold text-gray-500 mb-1">Category</label>
                            <select class="border p-2 rounded w-full">
                                <option>Homepage News</option>
                                <option>Gallery Image</option>
                                <option>Event Video</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button onclick="alert('News/Event Posted Successfully!')" class="bg-blue-600 text-white px-4 py-2 rounded font-bold">Post to Website</button>
            </div>

            <div class="bg-white p-6 rounded shadow mt-4">
                <h3 class="font-bold mb-4">Add Staff Member</h3>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <input id="adm-id" placeholder="Staff ID" class="border p-2">
                    <input id="adm-pass" placeholder="Password" class="border p-2">
                    <input id="adm-name" placeholder="Name" class="border p-2">
                    <select id="adm-role" class="border p-2"><option value="Teacher">Teacher</option><option value="GR">GR Incharge</option></select>
                </div>
                <button onclick="addStaff()" class="bg-green-600 text-white px-4 py-2 rounded">Save Staff</button>
            </div>
        </div>

    </main>

    <footer class="bg-gray-800 text-white py-6 mt-auto no-print">
        <div class="container mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
            <div class="text-sm">© 2026 Govt Comprehensive HSS Sukkur. All Rights Reserved.</div>
            <div class="flex items-center gap-3 mt-4 md:mt-0">
                <div class="text-right text-xs">
                    <p class="text-green-400 font-bold uppercase">Developed By</p>
                    <p>Ghulam Mehdi Junejo</p>
                </div>
                <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="w-10 h-10 rounded-full border-2 border-green-500">
            </div>
        </div>
    </footer>

    <div id="idCardModal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50 p-4 font-id-body overflow-y-auto">
        <div class="bg-slate-100 rounded-lg p-6 max-w-5xl w-full relative">
            <button onclick="document.getElementById('idCardModal').classList.add('hidden')" class="absolute top-2 right-2 text-red-600 font-bold z-50 hover:bg-red-100 p-2 rounded">✕ Close</button>
            
            <div class="text-center no-print mb-4">
                 <h3 class="font-bold text-2xl text-slate-800">Generated ID Card</h3>
                 <button onclick="printArea('id-card-print-area')" class="bg-blue-600 text-white px-6 py-2 rounded-full font-bold mt-2 shadow hover:bg-blue-700 transition">Print Card</button>
            </div>
            
            <div id="id-card-print-area" class="flex flex-col md:flex-row justify-center items-center gap-8">
                
                <div class="w-[350px] md:w-[450px]">
                    <h3 class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-2 text-center no-print">Front Side</h3>
                    <div id="student-card-front" class="relative w-full aspect-[1.7/1] bg-white rounded-xl shadow-2xl overflow-hidden flex flex-row border border-slate-200">
                        <div class="relative w-[35%] h-full bg-gradient-to-br from-green-800 via-green-600 to-green-500 flex flex-col items-center pt-4 pb-2">
                            <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                            <div class="relative z-10 flex items-center gap-1.5 text-white/90 mb-3">
                                <i class="ph-fill ph-student text-lg"></i>
                                <span class="text-[10px] font-bold tracking-[0.15em] uppercase">Identity</span>
                            </div>
                            <div class="relative z-20 w-24 h-24 p-1 bg-white/20 backdrop-blur-sm rounded-full shadow-lg">
                                <div class="w-full h-full bg-white rounded-full p-1 overflow-hidden relative">
                                    <img id="st-photo-display" src="" class="w-full h-full object-cover rounded-full bg-slate-100">
                                </div>
                            </div>
                            <div class="mt-auto text-center px-4 pb-2">
                                <p class="text-[8px] text-white/80 uppercase tracking-widest font-medium">Valid ID Card</p>
                            </div>
                        </div>
                        <div class="relative w-[65%] h-full p-4 flex flex-col">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-8 h-8 rounded-lg bg-green-50 text-green-800 flex items-center justify-center border border-green-100 shadow-sm flex-shrink-0">
                                    <img src="https://lh3.googleusercontent.com/d/1jnNNiAc2-DZUtVkABXetBkMGqB0olPju" class="w-6 h-6">
                                </div>
                                <div>
                                    <h1 id="st-school-display" class="text-sm font-extrabold text-slate-800 leading-tight tracking-tight uppercase">Govt. Comprehensive<br>HSS Sukkur</h1>
                                </div>
                            </div>
                            <div class="mt-1 mb-1">
                                <h2 id="st-name-display" class="text-lg font-bold text-slate-900 leading-tight truncate">Student Name</h2>
                                <span id="st-class-display" class="inline-block mt-0.5 px-2 py-0.5 bg-green-50 text-green-700 text-[10px] font-bold rounded-md uppercase tracking-wide border border-green-100">
                                    Class 10-A
                                </span>
                            </div>
                            <div class="mt-auto flex items-end justify-between gap-2">
                                <div class="bg-slate-50/80 rounded-lg p-2 border border-slate-100 flex-grow min-w-0">
                                    <div class="mb-1">
                                        <p class="text-[8px] uppercase text-slate-400 font-bold tracking-wider mb-0.5">Father's Name</p>
                                        <p id="st-father-display" class="text-[10px] font-bold text-slate-700 truncate">Father Name</p>
                                    </div>
                                    <div>
                                        <p class="text-[8px] uppercase text-slate-400 font-bold tracking-wider mb-0.5">Year</p>
                                        <p id="st-year-display" class="text-[10px] font-bold text-slate-700 truncate">2025 - 2026</p>
                                    </div>
                                </div>
                                <div class="flex-shrink-0 w-24 text-center pb-1">
                                    <div class="h-6 mb-1 flex items-center justify-center font-signature text-xl text-slate-600">
                                        Principal
                                    </div>
                                    <div class="h-px w-full bg-slate-200 mb-0.5"></div>
                                    <p class="text-[7px] uppercase text-slate-400 font-bold tracking-[0.2em]">Signature</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="w-[350px] md:w-[450px]">
                    <h3 class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-2 text-center no-print">Back Side</h3>
                    <div id="student-card-back" class="relative w-full aspect-[1.7/1] bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col border border-slate-200">
                        <div class="h-2 w-full bg-gradient-to-r from-green-800 via-green-600 to-green-500"></div>
                        <div class="p-4 flex-grow flex flex-col">
                            <div class="grid grid-cols-2 gap-4 mb-3">
                                <div class="flex gap-2">
                                    <div class="w-6 h-6 rounded-full bg-slate-50 flex items-center justify-center text-green-600 flex-shrink-0">
                                        <i class="ph-fill ph-map-pin text-xs"></i>
                                    </div>
                                    <div>
                                        <p class="text-[8px] uppercase text-slate-400 font-bold tracking-wider">Address</p>
                                        <p id="st-address-display" class="text-[9px] font-semibold text-slate-700 leading-tight mt-0.5">Board Office Road,<br>Makha Goth, Sukkur</p>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <div class="w-6 h-6 rounded-full bg-slate-50 flex items-center justify-center text-green-600 flex-shrink-0">
                                        <i class="ph-fill ph-phone text-xs"></i>
                                    </div>
                                    <div>
                                        <p class="text-[8px] uppercase text-slate-400 font-bold tracking-wider">Contact</p>
                                        <p id="st-contact-display" class="text-[9px] font-semibold text-slate-700 leading-tight mt-0.5">SEMIS: 418050146<br>071-5630250</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-slate-50 rounded-lg p-2 border border-slate-100 mb-2">
                                <ul class="text-[8px] text-slate-500 space-y-1 list-disc pl-3 leading-tight">
                                    <li>This card is the property of Govt. Comprehensive HSS Sukkur.</li>
                                    <li>Cardholder is responsible for the safekeeping of this ID.</li>
                                    <li>This card must be presented upon request by school authority.</li>
                                </ul>
                            </div>
                            <div class="mt-auto flex items-end justify-between">
                                <div>
                                    <p class="text-[8px] font-bold text-slate-800 uppercase tracking-wider mb-0.5">If found, return to:</p>
                                    <p class="text-[8px] text-slate-500">School Administration Office</p>
                                </div>
                                <div class="text-right">
                                     <div id="st-barcode-display" class="font-barcode text-slate-800 opacity-90 leading-none text-3xl">
                                        *123456*
                                     </div>
                                     <p id="st-id-display" class="text-[8px] font-mono text-slate-400 text-center tracking-widest mt-0.5">123456</p>
                                </div>
                            </div>
                        </div>
                        <div class="h-1 w-full bg-slate-100"></div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="loginModal" class="fixed inset-0 modal hidden flex items-center justify-center z-[100] no-print">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md mx-4 relative">
            <button onclick="document.getElementById('loginModal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400">✕</button>
            <h2 class="text-xl font-bold text-center text-green-900 mb-6">Portal Login</h2>
            <div class="flex bg-gray-100 p-1 rounded mb-4">
                <button onclick="setRole('student')" id="tab-student" class="flex-1 py-1 rounded bg-white shadow text-sm font-bold">Student</button>
                <button onclick="setRole('staff')" id="tab-staff" class="flex-1 py-1 rounded text-gray-500 text-sm font-bold">Staff</button>
                <button onclick="setRole('admin')" id="tab-admin" class="flex-1 py-1 rounded text-gray-500 text-sm font-bold">Admin</button>
            </div>
            <input id="login-user" placeholder="Username / Seat No" class="w-full border p-2 rounded mb-3">
            <input id="login-pass" type="password" placeholder="Password / GR No" class="w-full border p-2 rounded mb-4">
            <button onclick="doLogin()" id="btn-do-login" class="w-full bg-green-700 text-white py-2 rounded font-bold">Login</button>
            <p id="login-msg" class="text-red-500 text-xs text-center mt-2"></p>
        </div>
    </div>

    <script>
        lucide.createIcons();
        
        // ============================================
        //  API URL
        // ============================================
        const API_URL = "https://script.google.com/macros/s/AKfycbyM7Dk3mwU5FsRNLHnnjCXYgaE2mUMagNU_72Das-_W6S47YqmBUyfCbcxi3qveuHz1/exec";
        // ============================================

        let currentRole = 'student';
        let currentUser = null;
        let activeStudentData = null; 

        // --- CORE NAVIGATION ---
        function showSection(id) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.add('hidden'));
            const target = document.getElementById('section-' + id);
            if(target) target.classList.remove('hidden');
            window.scrollTo(0,0);
        }

        // --- LOGIN SYSTEM ---
        function openLoginModal() { document.getElementById('loginModal').classList.remove('hidden'); }
        function setRole(r) {
            currentRole = r;
            ['student','staff','admin'].forEach(x => {
                document.getElementById('tab-'+x).className = (x===r) ? "flex-1 py-1 rounded bg-white shadow text-sm font-bold" : "flex-1 py-1 rounded text-gray-500 text-sm font-bold";
            });
        }
        function doLogin() {
            const u = document.getElementById('login-user').value;
            const p = document.getElementById('login-pass').value;
            const btn = document.getElementById('btn-do-login');
            const msg = document.getElementById('login-msg');

            if(!u || !p) { msg.innerText = "Credentials required"; return; }
            
            btn.innerText = "Checking...";
            btn.disabled = true;
            
            fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'login', role: currentRole, username: u, password: p })})
            .then(r => r.json())
            .then(res => {
                btn.innerText = "Login";
                btn.disabled = false;
                if(res.success) {
                    currentUser = res;
                    document.getElementById('loginModal').classList.add('hidden');
                    document.getElementById('btn-login').classList.add('hidden');
                    document.getElementById('btn-logout').classList.remove('hidden');
                    
                    if(res.role === 'student') {
                        activeStudentData = res.data; 
                        renderMarksheet(res.data);
                        showSection('student');
                    } else if(res.role === 'teacher') {
                        showSection('teacher');
                    } else if(res.role === 'gr') {
                        showSection('gr');
                    } else if(res.role === 'admin') {
                        showSection('admin');
                    }
                } else {
                    msg.innerText = res.message;
                }
            })
            .catch(e => {
                 btn.innerText = "Login"; btn.disabled = false;
                 msg.innerText = "Connection Failed. Check URL.";
            });
        }

        function logout() {
            location.reload();
        }

        // --- STUDENT MARKSHEET ---
        function renderMarksheet(data) {
            const meta = document.getElementById('marksheet-meta');
            meta.innerHTML = `
                <div><p class="text-gray-500 text-sm">Student Name:</p><p class="font-bold text-lg border-b border-gray-300">${data.Name}</p></div>
                <div><p class="text-gray-500 text-sm">Father's Name:</p><p class="font-bold text-lg border-b border-gray-300">${data.FatherName}</p></div>
                <div><p class="text-gray-500 text-sm">Class / Group:</p><p class="font-bold border-b border-gray-300">${data.Class}</p></div>
                <div><p class="text-gray-500 text-sm">Seat Number:</p><p class="font-bold border-b border-gray-300">${data.SeatNo}</p></div>
            `;
            const body = document.getElementById('marksheet-body');
            body.innerHTML = '';
            
            let obtainedTotal = 0;
            let maxTotal = 0;
            
            const ignore = ['Name','FatherName','Class','SeatNo','GRNo','DateofBirth','AdmissionYear','Gender','Total','Result','Percentage','Grade','Position', 'SNo'];
            
            Object.keys(data).forEach(k => {
                if(!ignore.includes(k) && data[k]) {
                    maxTotal += 100; // Assume 100 Max Marks per subject
                    body.innerHTML += `
                        <tr>
                            <td class="border border-gray-300 p-2 capitalize">${k}</td>
                            <td class="border border-gray-300 p-2 text-right text-gray-500">100</td>
                            <td class="border border-gray-300 p-2 text-right font-bold">${data[k]}</td>
                        </tr>`;
                    if(!isNaN(data[k])) obtainedTotal += parseInt(data[k]);
                }
            });
            
            // Auto Update Footer
            document.getElementById('marksheet-max-total').innerText = maxTotal;
            document.getElementById('marksheet-total').innerText = obtainedTotal;
            
            // Auto Update Result Status
            let resText = data.Result;
            if(!resText) {
                resText = (obtainedTotal >= (maxTotal * 0.33)) ? "PASS" : "FAIL";
            }
            const resEl = document.getElementById('rResult');
            resEl.innerText = resText;
            resEl.className = resText.toUpperCase().includes('FAIL') ? "text-2xl font-bold text-red-600" : "text-2xl font-bold text-green-600";
        }

        // --- TEACHER: ATTENDANCE ---
        function showTeacherTab(tab) {
            document.getElementById('tab-attendance').classList.add('hidden');
            document.getElementById('tab-result').classList.add('hidden');
            document.getElementById('tab-'+tab).classList.remove('hidden');
        }

        function loadAttendanceList() {
            const cls = document.getElementById('att-class').value;
            const grid = document.getElementById('attendance-grid');
            grid.innerHTML = "Fetching...";
            
            fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'getStudentsByClass', cls: cls })})
            .then(r => r.json())
            .then(res => {
                grid.innerHTML = "";
                if(res.success && res.data.length > 0) {
                    res.data.forEach(s => {
                        grid.innerHTML += `
                            <label class="bg-white p-2 border rounded flex items-center justify-between cursor-pointer hover:bg-red-50">
                                <span class="text-sm font-bold">${s.SeatNo} - ${s.Name}</span>
                                <input type="checkbox" value="${s.SeatNo}" class="att-chk w-5 h-5 accent-red-600">
                            </label>`;
                    });
                    document.getElementById('btn-submit-att').classList.remove('hidden');
                } else {
                    grid.innerHTML = "No students found.";
                }
            });
        }

        function submitAttendance() {
            const cls = document.getElementById('att-class').value;
            const checks = document.querySelectorAll('.att-chk:checked');
            const absents = Array.from(checks).map(c => c.value);
            
            fetch(API_URL, { method: 'POST', body: JSON.stringify({ 
                action: 'markAttendance', 
                date: new Date().toLocaleDateString(), 
                class: cls, 
                absentIds: absents 
            })})
            .then(r => r.json())
            .then(res => alert(res.message));
        }

        // --- GR PORTAL ---
        function searchGRData() {
            const q = document.getElementById('gr-search').value;
            fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'getStudentFullDetail', query: q })})
            .then(r => r.json())
            .then(res => {
                if(res.success) {
                    activeStudentData = res.data;
                    document.getElementById('gr-result-view').classList.remove('hidden');
                    
                    const d = res.data;
                    document.getElementById('gr-data-content').innerHTML = `
                        <p><b>GR No:</b> ${d.GRNo}</p> <p><b>Date of Birth:</b> ${d.DateofBirth || 'N/A'}</p>
                        <p><b>Name:</b> ${d.Name}</p> <p><b>Year of Adm:</b> ${d.AdmissionYear || 'N/A'}</p>
                        <p><b>Father:</b> ${d.FatherName}</p> <p><b>Class:</b> ${d.Class}</p>
                        <p><b>Gender:</b> ${d.Gender || 'N/A'}</p> <p><b>Seat No:</b> ${d.SeatNo}</p>
                    `;

                    document.getElementById('slc-name').innerText = d.Name;
                    document.getElementById('slc-father').innerText = d.FatherName;
                    document.getElementById('slc-gr').innerText = d.GRNo;
                    document.getElementById('slc-dob').innerText = d.DateofBirth || "__________";
                    document.getElementById('slc-card').classList.remove('hidden'); 
                } else {
                    alert("Not Found");
                }
            });
        }
        
        // --- UPDATED PRINTING LOGIC ---
        function printArea(elementId) {
            // 1. Remove 'print-now' from any previously selected element
            document.querySelectorAll('.print-now').forEach(e => e.classList.remove('print-now'));
            
            // 2. Add 'print-now' to the specific element we want to print
            const target = document.getElementById(elementId);
            if(target) {
                target.classList.add('print-now');
                window.print();
                
                // 3. Cleanup: Remove the class after printing (optional but good for state)
                setTimeout(() => {
                    target.classList.remove('print-now');
                }, 1000);
            } else {
                alert("Error: Content to print not found.");
            }
        }

        // --- ID CARD GENERATOR ---
        function generateCard(type) {
            let name, sub, father, year, idLabel, idVal, imgSrc;
            const schoolName = "Govt. Comprehensive HSS";
            
            // Default Values
            year = "2025 - 2026";
            
            if(type === 'student' || type === 'gr-student') {
                if(!activeStudentData) return alert("No Student Selected or Logged In");
                name = activeStudentData.Name;
                father = activeStudentData.FatherName;
                sub = `Class ${activeStudentData.Class}`;
                idVal = activeStudentData.GRNo;
                imgSrc = "https://lh3.googleusercontent.com/d/1jnNNiAc2-DZUtVkABXetBkMGqB0olPju"; 
            } else if (type === 'staff') {
                if(!currentUser) return alert("Not Logged In");
                name = currentUser.name;
                father = "Teaching Staff"; 
                sub = currentUser.designation || "Teacher";
                idVal = currentUser.id;
                imgSrc = "https://cdn-icons-png.flaticon.com/512/3135/3135768.png";
            }

            document.getElementById('st-name-display').innerText = name;
            document.getElementById('st-father-display').innerText = father;
            document.getElementById('st-class-display').innerText = sub;
            document.getElementById('st-year-display').innerText = year;
            
            document.getElementById('st-id-display').innerText = idVal;
            document.getElementById('st-barcode-display').innerText = "*" + idVal + "*";
            document.getElementById('st-photo-display').src = imgSrc;
            
            document.getElementById('idCardModal').classList.remove('hidden');
        }

        function addStaff() {
            const data = {
                action: 'adminUpdateStaff',
                mode: 'add',
                id: document.getElementById('adm-id').value,
                password: document.getElementById('adm-pass').value,
                name: document.getElementById('adm-name').value,
                role: document.getElementById('adm-role').value
            };
            fetch(API_URL, {method:'POST', body:JSON.stringify(data)})
            .then(r=>r.json()).then(res => alert(res.message));
        }

        // --- INITIALIZATION ---
        window.onload = function() {
            // Slider
            let slideIndex = 0;
            const slides = document.querySelectorAll('.slide');
            if(slides.length > 0) {
                setInterval(() => {
                    slides.forEach(s => s.classList.remove('active'));
                    slideIndex = (slideIndex + 1) % slides.length;
                    slides[slideIndex].classList.add('active');
                }, 4000);
            }

            // Charts Config - Compact
            const chartConfig = (id, data, color) => {
                const ctx = document.getElementById(id);
                if(ctx) {
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Present', 'Absent'],
                            datasets: [{
                                data: data,
                                backgroundColor: [color, '#e5e7eb'],
                                borderWidth: 0,
                                hoverOffset: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            cutout: '75%'
                        }
                    });
                }
            };

            chartConfig('studentChart', [85, 15], '#166534'); // School Green
            chartConfig('teacherChart', [96, 4], '#1e40af'); // Blue

            // Load Dashboard
            fetch(`${API_URL}?action=getDashboardStats`)
            .then(r=>r.json())
            .then(res=>{
                if(res.success && document.getElementById('notice-board')) {
                    document.getElementById('notice-board').innerHTML = res.data.notifications.map(n=>`<div class="border-b py-1 mb-1">➢ ${n}</div>`).join('');
                }
            })
            .catch(e => console.log("Init Error: " + e));
        };
    </script>
</body>
</html>
