<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STEM Gas Lab</title>
    <style>
        body { margin: 0; background-color: #222; color: white; font-family: sans-serif; display: flex; height: 100vh; }
        
        /* Sidebar controls */
        .sidebar { width: 250px; background: #333; padding: 20px; border-right: 1px solid #444; }
        h2 { margin-top: 0; color: #4db8ff; }
        label { display: block; margin-top: 15px; font-size: 14px; color: #bbb; }
        input[type=range] { width: 100%; margin-top: 5px; }
        
        .readout { 
            background: #000; padding: 10px; border-radius: 5px; margin-top: 20px; 
            font-family: monospace; color: #0f0; 
        }
        
        /* The Container */
        #simulation-area { flex-grow: 1; position: relative; display: flex; justify-content: center; align-items: flex-end; padding-bottom: 50px; }
        
        #container-box {
            width: 400px; height: 500px; border: 5px solid #888; border-top: none; 
            position: relative; background: rgba(255, 255, 255, 0.05);
        }
        
        /* The Moving Piston */
        #piston {
            width: 400px; height: 20px; background: #aaa; position: absolute; top: 0; left: 0;
            border-bottom: 2px solid #fff; transition: top 0.1s;
        }
        #piston::after { content: "Piston (Volume)"; display: block; text-align: center; font-size: 10px; color: black; line-height: 20px; }
        
        /* Particles are drawn on canvas overlay */
        canvas { position: absolute; top: 0; left: 0; pointer-events: none; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>ðŸ§ª Gas Properties</h2>
        
        <label>TEMPERATURE (Heat)</label>
        <input type="range" id="temp" min="1" max="100" value="20">
        
        <label>VOLUME (Piston Height)</label>
        <input type="range" id="volume" min="100" max="500" value="500" style="direction: rtl"> 
        <div class="readout">
            PRESSURE: <span id="pressureVal">0</span> kPa<br>
            SPEED: <span id="speedVal">0</span> m/s
        </div>
        
        <p style="font-size: 12px; color: #888; margin-top: 20px;">
            <b>Boyle's Law:</b> Decrease Volume -> Increase Pressure.<br>
            <b>Charles's Law:</b> Increase Temp -> Molecules speed up.
        </p>
    </div>

    <div id="simulation-area">
        <div id="container-box">
            <div id="piston"></div>
            <canvas id="gasCanvas"></canvas>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gasCanvas');
        const ctx = canvas.getContext('2d');
        const box = document.getElementById('container-box');
        
        // Simulation State
        let particles = [];
        const numParticles = 100;
        let pistonHeight = 0; // Top position relative to box
        let boxHeight = 500;
        let boxWidth = 400;
        let temperature = 20;
        let pressure = 0;

        // Resize
        canvas.width = boxWidth;
        canvas.height = boxHeight;

        class Particle {
            constructor() {
                this.r = 3;
                this.x = Math.random() * boxWidth;
                this.y = Math.random() * boxHeight;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.color = `hsl(${Math.random()*60 + 200}, 100%, 70%)`; // Blue-ish
            }

            update() {
                // Apply Temperature (Speed Multiplier)
                // We normalize velocity then multiply by Temp
                let speed = Math.sqrt(this.vx*this.vx + this.vy*this.vy);
                if(speed === 0) speed = 0.1;
                
                // Target speed based on temp slider
                let targetSpeed = temperature / 10; 
                
                // Smoothly adjust speed to target (Simulate heating/cooling)
                let scale = targetSpeed / speed;
                this.vx *= scale;
                this.vy *= scale;

                // Move
                this.x += this.vx;
                this.y += this.vy;

                // Bounce Walls
                if (this.x < 0 || this.x > boxWidth) {
                    this.vx *= -1;
                    this.x = Math.max(0, Math.min(boxWidth, this.x));
                    pressure++; // Hit wall = Pressure
                }

                // Bounce Piston (Top) & Floor (Bottom)
                let currentCeiling = pistonHeight; // Piston Y position
                
                if (this.y > boxHeight) {
                    this.vy *= -1;
                    this.y = boxHeight;
                }
                if (this.y < currentCeiling) {
                    this.vy *= -1;
                    this.y = currentCeiling;
                    pressure++; // Hit piston = Pressure
                }
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
            }
        }

        // Init Particles
        for(let i=0; i<numParticles; i++) particles.push(new Particle());

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw Piston
            const pistonEl = document.getElementById('piston');
            pistonEl.style.height = pistonHeight + "px"; // Visual trick: piston is actually the empty space above?
            // Better visual: The piston is a div, we just need to know where its bottom edge is.
            // Let's invert the slider logic. 
            // Slider Value 500 = Full Height (Piston at 0).
            // Slider Value 100 = Small Height (Piston at 400).
            let vol = parseInt(document.getElementById('volume').value);
            let effectiveHeight = vol; 
            pistonHeight = boxHeight - effectiveHeight; 
            pistonEl.style.top = pistonHeight + "px"; // Move the div
            pistonEl.style.height = "20px"; // Just the bar

            // Reset Pressure counter every frame (instantaneous pressure)
            // For smoother reading, we'd average it, but this is fine for demo
            let currentPressure = pressure;
            pressure = 0;

            particles.forEach(p => {
                p.update();
                p.draw();
            });

            // Update DOM
            temperature = parseInt(document.getElementById('temp').value);
            document.getElementById('pressureVal').innerText = currentPressure; // Hits per frame
            document.getElementById('speedVal').innerText = (temperature/10).toFixed(1);

            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>